const r=Shopware.Classes.ApiService,{Application:n}=Shopware;class c extends r{constructor(s,a,e="adyen"){super(s,a,e),this.headers=this.getBasicHeaders({})}check(s){const a=this.getBasicHeaders({});return this.httpClient.post(`_action/${this.getApiBasePath()}/verify`,s,{headers:a}).then(e=>r.handleResponse(e))}capture(s){return this.httpClient.post(this.getApiBasePath()+"/capture",{orderId:s},{headers:this.headers}).then(a=>r.handleResponse(a)).catch(a=>{throw console.error("An error occurred during capture request: "+a.message),a})}getCaptureRequests(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s+"/captures",{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred during capture request: "+e.message),e})}isCaptureAllowed(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s+"/is-capture-allowed",{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred during is-capture-allowed request: "+e.message),e})}isManualCaptureEnabled(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s+"/is-manual-capture-enabled",{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred during is-capture-allowed request: "+e.message),e})}getRefunds(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s+"/refunds",{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred during refunds request: "+e.message),e})}postRefund(s,a){const e=this.getBasicHeaders({});return this.httpClient.post(this.getApiBasePath()+"/refunds",{orderId:s,refundAmount:a},{headers:e}).then(i=>r.handleResponse(i)).catch(i=>{throw console.error("An error occurred during post refund request: "+i.message),i})}fetchNotifications(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s+"/notifications",{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred: "+e.message),e})}rescheduleNotification(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/reschedule-notification/"+s,{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred: "+e.message),e})}isAdyenOrder(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s.id+"/is-adyen-order",{headers:a}).then(e=>r.handleResponse(e)).then(e=>e.status).catch(e=>(console.error("An error occurred: "+e.message),!1))}fetchAdyenPartialPayments(s){const a=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+s+"/partial-payments",{headers:a}).then(e=>r.handleResponse(e)).catch(e=>{throw console.error("An error occurred: "+e.message),e})}}n.addServiceProvider("adyenService",t=>{const s=n.getContainer("init");return new c(s.httpClient,t.loginService)});const l='<div> <sw-button-process :disabled="isLoading" :isLoading="isLoading" :processSuccess="isSaveSuccessful" @process-finish="saveFinish" @click="check" >Test Configuration</sw-button-process> </div>',{Component:u,Mixin:h}=Shopware;u.register("adyen-config-check-button",{template:l,inject:["adyenService"],mixins:[h.getByName("notification")],data(){return{isLoading:!1,isSaveSuccessful:!1}},computed:{pluginConfig(){let t=this.$parent;for(;t.actualConfigData===void 0;)t=t.$parent;let s=t.currentSalesChannelId,a=t.actualConfigData;return Object.assign({},a.null,a[s])}},methods:{saveFinish(){this.isSaveSuccessful=!1},check(){this.isLoading=!0,this.adyenService.check(this.pluginConfig).then(t=>{t.success?(this.isSaveSuccessful=!0,this.createNotificationSuccess({title:this.$tc("adyen.configTestTitle"),message:this.$tc("adyen.configTestSuccess")})):this.createNotificationError({title:this.$tc("adyen.configTestTitle"),message:this.$tc(t.message?t.message:"adyen.configTestFail")}),this.isLoading=!1})}}});const p=`{% block adyen_capture %} <sw-card :isLoading="isLoading" :title="$tc('adyen.adyenPaymentCaptureTitle')" v-if="showWidget" :large="false" :hero="false"> <div v-if="!errorOccurred"> <div class="adyen-capture-card-header"> <div class="adyen-capture-card-header-first"> <span v-if="!captureRequests.length">{{ $tc('adyen.noCaptureRequests') }}</span> </div> <div id="modalButtonContainer"> <sw-button :disabled="!allowCapture" :square="false" :block="false" @click="openModal" class="sw-button--small"> {{ $tc('adyen.sendCaptureRequest') }} </sw-button> </div> <sw-modal v-if="showModal" @modal-close="onCloseModal" :title="$tc('adyen.captureConfirm') + ': ' + order.orderNumber" variant="small"> <template #modal-footer> <sw-button @click="onCloseModal" size="small"> {{ $tc('global.default.cancel') }} </sw-button> <sw-button @click="onSubmitCapture" variant="primary" size="small" :isLoading="isLoading"> {{ $tc('adyen.sendCaptureRequest') }} </sw-button> </template> </sw-modal> </div> <sw-data-grid v-if="captureRequests.length" :dataSource="captureRequests" :columns="columns" :showSelection="false" :showActions="false" :isLoading="isLoading"> </sw-data-grid> </div> <div v-else> {{ $tc('adyen.error') }} </div> </sw-card> {% endblock %}`,{Component:f,Mixin:g}=Shopware;f.register("adyen-payment-capture",{template:p,inject:["adyenService","systemConfigApiService"],mixins:[g.getByName("notification")],props:{order:{type:Object,required:!0}},data(){return{columns:[{property:"pspReference",label:this.$tc("adyen.columnHeaders.pspReference")},{property:"amount",label:this.$tc("adyen.columnHeaders.amount")},{property:"status",label:this.$tc("adyen.columnHeaders.status")},{property:"createdAt",label:this.$tc("adyen.columnHeaders.created")},{property:"updatedAt",label:this.$tc("adyen.columnHeaders.updated")}],showModal:!1,captureRequests:[],allowCapture:!1,captureEnabled:!1,errorOccurred:!1,isLoading:!0,showWidget:!1}},watch:{"order.id":{immediate:!1,handler(t){this.showWidget=!1,this.captureRequests=[],this.allowCapture=!1,this.captureEnabled=!1,this.errorOccurred=!1,this.isLoading=!0,this.isManualCaptureEnabled(),this.fetchCaptureRequests()}}},methods:{openModal(){this.showModal=!0},onCloseModal(){this.showModal=!1},onSubmitCapture(){this.isLoading!==!0&&(this.isLoading=!0,this.adyenService.capture(this.order.id).then(t=>{t.success?(this.fetchCaptureRequests(),this.createNotificationSuccess({title:this.$tc("adyen.adyenPaymentCaptureTitle"),message:this.$tc("adyen.captureSuccessful")})):this.createNotificationError({title:this.$tc("adyen.adyenPaymentCaptureTitle"),message:this.$tc(t.message?t.message:"adyen.error")})}).catch(()=>{this.createNotificationError({title:this.$tc("adyen.adyenPaymentCaptureTitle"),message:this.$tc("adyen.error")})}).finally(()=>{this.isLoading=!1,this.showModal=!1}))},fetchCaptureRequests(){this.isLoading=!0,this.adyenService.getCaptureRequests(this.order.id).then(t=>{this.captureRequests=t,this.isCaptureAllowed()}).catch(()=>{this.errorOccurred=!0,this.captureRequests=[]}).finally(()=>{this.isLoading=!1})},isManualCaptureEnabled(){this.isLoading=!0,this.adyenService.isManualCaptureEnabled(this.order.id).then(t=>{this.captureEnabled=t,this.showWidget=this.adyenService.isAdyenOrder(this.order)&&this.captureEnabled}).catch(()=>{this.errorOccurred=!0,this.captureEnabled=!1}).finally(()=>{this.isLoading=!1})},isCaptureAllowed(){this.isLoading=!0,this.adyenService.isCaptureAllowed(this.order.id).then(t=>{this.allowCapture=t}).catch(()=>{this.errorOccurred=!0,this.allowCapture=!1}).finally(()=>{this.isLoading=!1})}},beforeMount(){this.isManualCaptureEnabled(),this.fetchCaptureRequests()}});const m=`{% block adyen_refund %} <sw-card :hero="false" :isLoading="isLoadingTable" :large="false" :title="$tc('adyen.adyenRefunds')" v-if="showWidget"> <div v-if="!errorOccurred"> <div class="adyen-refund-card-header"> <div class="adyen-refund-card-header-first"> <span v-if="!refunds.length">{{ $tc('adyen.noRefundsCreated') }}</span> </div> <div id="modalButtonContainer"> <sw-button :disabled="!allowRefund" :square="false" :block="false" @click="openModal" class="sw-button--small"> {{ $tc('sw-order.documentCard.labelCreateNew') }} </sw-button> </div> <sw-modal v-if="showModal" @modal-close="onCloseModal" :title="$tc('adyen.refundConfirm') + ': ' + order.orderNumber" variant="small"> <div> <sw-number-field type="refundAmount" numberType="float" :allowEmpty="false" v-model:value="refundAmount" placeholder="Amount"> </sw-number-field> </div> <template #modal-footer> <sw-button @click="onCloseModal" size="small"> {{ $tc('global.default.cancel') }} </sw-button> <sw-button @click="onRefund" variant="primary" size="small" :isLoading="isLoadingRefund"> {{ $tc('sw-order.documentCard.labelCreateNew') }} </sw-button> </template> </sw-modal> </div> <sw-data-grid v-if="refunds.length" :dataSource="refunds" :columns="columns" :showSelection="false" :showActions="false" :isLoading="isLoadingTable"> </sw-data-grid> </div> <div v-else> {{ $tc('adyen.refundFetchError') }} </div> </sw-card> {% endblock %}`,{Component:y,Mixin:w}=Shopware;y.register("adyen-refund",{template:m,inject:["adyenService"],mixins:[w.getByName("notification")],props:{order:{type:Object,required:!0}},data(){return{columns:[{property:"pspReference",label:this.$tc("adyen.columnHeaders.pspReference")},{property:"amount",label:this.$tc("adyen.columnHeaders.amount")},{property:"status",label:this.$tc("adyen.columnHeaders.status")},{property:"createdAt",label:this.$tc("adyen.columnHeaders.created")},{property:"updatedAt",label:this.$tc("adyen.columnHeaders.updated")}],refundAmount:0,showModal:!1,refunds:[],allowRefund:!0,isLoadingTable:!0,errorOccurred:!1,isLoadingRefund:!1,showWidget:!1}},watch:{"order.id":{immediate:!1,handler(t){this.showWidget=!1,this.refunds=[],this.allowRefund=!0,this.errorOccurred=!1,this.isLoadingTable=!0,this.adyenService.isAdyenOrder(this.order).then(s=>{this.showWidget=s,s&&this.fetchRefunds()})}}},methods:{openModal(){this.showModal=!0},onCloseModal(){this.showModal=!1},onRefund(){this.isLoadingRefund!==!0&&(this.isLoadingRefund=!0,this.adyenService.postRefund(this.order.id,this.refundAmount).then(t=>{t.success?(this.fetchRefunds(),this.createNotificationSuccess({title:this.$tc("adyen.refundTitle"),message:this.$tc("adyen.refundSuccessful")})):this.createNotificationError({title:this.$tc("adyen.refundTitle"),message:this.$tc(t.message?t.message:"adyen.error")})}).catch(()=>{this.createNotificationError({title:this.$tc("adyen.refundTitle"),message:this.$tc("adyen.error")})}).finally(()=>{this.isLoadingRefund=!1,this.showModal=!1}))},fetchRefunds(){this.isLoadingTable=!0,this.adyenService.getRefunds(this.order.id).then(t=>{this.refunds=t,this.isRefundAllowed()}).catch(()=>{this.errorOccurred=!0,this.refunds=[]}).finally(()=>{this.isLoadingTable=!1})},isRefundAllowed(){let t=0;for(const s of this.refunds)s.status!=="Failed"&&(t+=s.rawAmount);this.allowRefund=this.order.amountTotal>t/100}},async beforeMount(){this.showWidget=await this.adyenService.isAdyenOrder(this.order),this.showWidget&&this.fetchRefunds()}});const b=`{% block adyen_notifications %} <div v-if="showWidget"> <sw-card :title="$tc('adyen.notificationsTitle')"> <sw-data-grid v-if="notifications.length" :dataSource="notifications" :columns="columns" :showActions="true" :showSelection="false" :showSettings="true" > {% block sw_data_grid_body_columns %} {% block sw_data_grid_column_actions %} <template #actions="{ item }"> {% block sw_data_grid_column_actions_reschedule %} <sw-context-menu-item v-if="item.canBeRescheduled" @click="onReschedule(item)" > {{ $tc('adyen.reprocessNotification') }} </sw-context-menu-item> {% endblock %} </template> {% endblock %} {% endblock %} </sw-data-grid> <p v-if="!notifications.length">{{ $tc('adyen.noNotificationsReceived') }}</p> </sw-card> </div> {% endblock %}`,{Component:v,Mixin:_}=Shopware;v.register("adyen-notifications",{template:b,inject:["adyenService"],mixins:[_.getByName("notification")],props:{order:{type:Object,required:!0}},data(){return{notifications:[],columns:[{property:"pspReference",label:this.$tc("adyen.columnHeaders.pspReference")},{property:"eventCode",label:this.$tc("adyen.columnHeaders.event")},{property:"success",label:this.$tc("adyen.columnHeaders.success")},{property:"amount",label:this.$tc("adyen.columnHeaders.amount")},{property:"status",label:this.$tc("adyen.columnHeaders.status")},{property:"createdAt",label:this.$tc("adyen.columnHeaders.created")},{property:"updatedAt",label:this.$tc("adyen.columnHeaders.updated")},{property:"errorCount",label:this.$tc("adyen.columnHeaders.errorCount")},{property:"errorMessage",label:this.$tc("adyen.columnHeaders.errorMessage")}],showWidget:!1}},watch:{"order.id":{immediate:!1,handler(t){this.showWidget=!1,this.notifications=[],this.adyenService.isAdyenOrder(this.order).then(s=>{this.showWidget=s,s&&this.fetchNotifications()})}}},methods:{fetchNotifications(){this.adyenService.fetchNotifications(this.order.id).then(t=>{this.notifications=t})},onReschedule(t){this.adyenService.rescheduleNotification(t.notificationId).then(s=>{this.createNotificationSuccess({title:this.$tc("adyen.reprocessNotification"),message:this.$tc("adyen.notificationRescheduleSuccess")}),this.fetchNotifications()})}},async beforeMount(){this.showWidget=await this.adyenService.isAdyenOrder(this.order),this.showWidget&&this.fetchNotifications()}});const C=`<div v-if="showWidget"> <ul v-if="isVersionOlderThan65"> <dt>{{ $tc('adyen.authorisedPayments') }}</dt> <dd v-for="payment in partialPayments"> <a v-bind:href="payment.caLink" target="_blank">{{ payment.pspReference }}</a> - <span>{{ payment.method }}</span> - <span>{{ payment.amount }}</span> </dd> <dd>{{ errorMessage }}</dd> </ul> <ul v-else> <label>{{ $tc('adyen.authorisedPayments') }}</label> <div class="sw-data-grid is--compact sw-data-grid--plain-appearance"> <div class="sw-data-grid__wrapper"> <table class="sw-data-grid__table"> <thead class="sw-data-grid__header"> <tr class="sw-data-grid__rx ow"> <th class="sw-data-grid__cell sw-data-grid__cell--header sw-data-grid__cell--property sw-data-grid__cell--sortable sw-data-grid__cell--align-left"> <div class="sw-data-grid__cell-content"> PSP Reference </div> </th> <th class="sw-data-grid__cell sw-data-grid__cell--header sw-data-grid__cell--property sw-data-grid__cell--sortable sw-data-grid__cell--align-left"> <div class="sw-data-grid__cell-content"> Payment Method </div> </th> <th class="sw-data-grid__cell sw-data-grid__cell--header sw-data-grid__cell--property sw-data-grid__cell--sortable sw-data-grid__cell--align-left"> <div class="sw-data-grid__cell-content"> Amount </div> </th> </tr> </thead> <tbody class="sw-data-grid__body"> <tr v-for="payment in partialPayments" class="sw-data-grid__row"> <td class="sw-data-grid__cell sw-data-grid__cell--order sw-data-grid__cell--align-left"> <div class="sw-data-grid__cell-content"> <a v-bind:href="payment.caLink" target="_blank">{{ payment.pspReference }}</a> </div> </td> <td class="sw-data-grid__cell sw-data-grid__cell--order sw-data-grid__cell--align-left"> <div class="sw-data-grid__cell-content"> {{ payment.method }} </div> </td> <td class="sw-data-grid__cell sw-data-grid__cell--order sw-data-grid__cell--align-left"> <div class="sw-data-grid__cell-content"> {{ payment.amount }} </div> </td> </tr> </tbody> </table> </div> </div> <span>{{ errorMessage }}</span> </ul> </div>`;let o={};o.isVersionOlderThan65=()=>{function t(a,e){return a.startsWith(e+"-")?-1:e.startsWith(a+"-")?1:a.localeCompare(e,void 0,{numeric:!0,sensitivity:"case",caseFirst:"upper"})}const s=Shopware.Context.app.config.version;return t(s,"6.5.0.0")===-1};const{Component:R}=Shopware;R.register("adyen-partial-payments",{template:C,inject:["adyenService"],props:{order:{type:Object,required:!0}},methods:{fetchAdyenPartialPayments(){this.adyenService.fetchAdyenPartialPayments(this.order.id).then(t=>{t.length>0?this.partialPayments=t:this.errorMessage=this.$tc("adyen.pendingWebhook")})}},data(){return{errorMessage:"",partialPayments:[],showWidget:!1,isVersionOlderThan65:!1}},async beforeMount(){this.isVersionOlderThan65=o.isVersionOlderThan65(),this.showWidget=await this.adyenService.isAdyenOrder(this.order),this.showWidget&&this.fetchAdyenPartialPayments()}});const S='{% block sw_order_detail_general_line_items_card %} {% parent %} <adyen-payment-capture :order="order"></adyen-payment-capture> <adyen-refund :order="order"></adyen-refund> <adyen-notifications :order="order"></adyen-notifications> {% endblock %}';Shopware.Component.override("sw-order-detail-general",{template:S});const $='{% block sw_order_detail_base_custom_fields %} {% parent %} <adyen-payment-capture :order="order"></adyen-payment-capture> <adyen-refund :order="order"></adyen-refund> <adyen-notifications :order="order"></adyen-notifications> {% endblock %}';Shopware.Component.override("sw-order-detail-base",{template:$});const A='{% block sw_order_detail_base_secondary_info_payment %} {% parent %} <adyen-partial-payments :order="currentOrder"></adyen-partial-payments> {% endblock %}';Shopware.Component.override("sw-order-user-card",{template:A});const k='{% block sw_order_detail_details_payment_method_select %} {% parent %} <adyen-partial-payments :order="order"></adyen-partial-payments> {% endblock %}';Shopware.Component.override("sw-order-detail-details",{template:k});const{Component:M}=Shopware,{Criteria:d}=Shopware.Data;M.extend("sw-entity-single-select-override","sw-entity-single-select",{props:{criteria:{type:Object,required:!1,default(){const t=(this==null?void 0:this.resultLimit)??25,s=new d(1,t);return s.addFilter(d.equals("stateMachine.technicalName","order_delivery.state")),s}}}});const L={configTestTitle:"Configuration test",configTestSuccess:"Configuration is successfully tested",configTestFail:"There's an issue in your configuration",adyenRefunds:"Adyen Refunds",refundTitle:"Refund",refundSuccessful:"A refund has been successfully submitted.",invalidRefundAmount:"Refund amount exceeds order total",error:"An error has occurred. Please check the logs.",refundFetchError:"An error has occurred while attempting to get linked refunds.",refundConfirm:"Create refund for order",createRefund:"Create Refund",noRefundsCreated:"No refunds created",columnHeaders:{pspReference:"PSP Reference",amount:"Amount",status:"Status",event:"Event",success:"Success",created:"Created",updated:"Updated",errorCount:"Error Count",errorMessage:"Error Message"},reprocessNotification:"Reprocess Notification",notificationRescheduleSuccess:"Notification will be processed again.",notificationsTitle:"Adyen Webhook Notifications",noNotificationsReceived:"No webhook notifications received.",adyenPaymentCaptureTitle:"Adyen Capture Requests",noCaptureRequests:"No capture requests have been sent",sendCaptureRequest:"Send Capture Request",captureConfirm:"Capture payment for order",captureSuccessful:"Capture request has been successfully sent",pendingWebhook:"Order is pending webhook.",authorisedPayments:"Authorised Payments"},P={adyen:L};Shopware.Locale.extend("en-GB",P);
//# sourceMappingURL=adyen-payment-shopware6-BIKNtqAG.js.map
