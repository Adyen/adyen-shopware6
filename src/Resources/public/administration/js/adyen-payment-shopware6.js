(this.webpackJsonp=this.webpackJsonp||[]).push([["adyen-payment-shopware6"],{"5obj":function(e,n){e.exports='{% block adyen_refund %}\n    <sw-card :hero="false" :isLoading="isLoadingTable" :large="false" title="Refunds" v-if="showWidget">\n        <div v-if="!errorOccurred">\n            <div class="adyen-card-header">\n                <div class="adyen-card-header-first">\n                    <span v-if="!refunds.length">{{ $tc(\'adyen.noRefundsCreated\') }}</span>\n                </div>\n                <div id="modalButtonContainer">\n                    <sw-button\n                        :disabled="!allowRefund"\n                        :square="false"\n                        :block="false"\n                        @click="openModal"\n                        class="sw-button--small">\n                        {{ $tc(\'sw-order.documentCard.labelCreateNew\') }}\n                    </sw-button>\n                </div>\n                <sw-modal v-if="showModal"\n                        @modal-close="onCloseModal"\n                        :title="$tc(\'adyen.createRefund\')"\n                        variant="small">\n                    {{ $tc(\'adyen.refundConfirm\') }} <b>{{ order.orderNumber }}</b>?\n                    <template #modal-footer>\n                        <sw-button @click="onCloseModal" size="small">\n                            {{ $tc(\'global.default.cancel\') }}\n                        </sw-button>\n\n                        <sw-button @click="onRefund" variant="primary" size="small" :isLoading="isLoadingRefund">\n                            {{ $tc(\'sw-order.documentCard.labelCreateNew\') }}\n                        </sw-button>\n                    </template>\n                </sw-modal>\n            </div>\n            <sw-data-grid\n                v-if="refunds.length"\n                :dataSource="refunds"\n                :columns="columns"\n                :showSelection="false"\n                :showActions="false"\n                :isLoading="isLoadingTable">\n            </sw-data-grid>\n        </div>\n        <div v-else>\n            {{ $tc(\'adyen.refundFetchError\') }}\n        </div>\n    </sw-card>\n{% endblock %}\n'},"84YS":function(e,n,t){"use strict";t.r(n);t("EVLM");var s=t("Dj87"),r=t.n(s);const{Component:a,Mixin:i}=Shopware;a.register("adyen-config-check-button",{template:r.a,inject:["adyenService"],mixins:[i.getByName("notification")],data:()=>({isLoading:!1,isSaveSuccessful:!1}),computed:{pluginConfig(){let e=this.$parent;for(;!e.hasOwnProperty("actualConfigData");)e=e.$parent;let n=e.currentSalesChannelId,t=e.actualConfigData;return Object.assign({},t.null,t[n])}},methods:{saveFinish(){this.isSaveSuccessful=!1},check(){this.isLoading=!0,this.adyenService.check(this.pluginConfig).then(e=>{e.success?(this.isSaveSuccessful=!0,this.createNotificationSuccess({title:this.$tc("adyen.configTestTitle"),message:this.$tc("adyen.configTestSuccess")})):this.createNotificationError({title:this.$tc("adyen.configTestTitle"),message:this.$tc(e.message?e.message:"adyen.configTestFail")}),this.isLoading=!1})}}});var o=t("5obj"),d=t.n(o);t("wqQl");const{Component:c,Mixin:l}=Shopware;c.register("adyen-refund",{template:d.a,inject:["adyenService"],mixins:[l.getByName("notification")],props:{order:{type:Object,required:!0}},data(){return{columns:[{property:"pspReference",label:this.$tc("adyen.columnHeadersPspReference")},{property:"amount",label:this.$tc("adyen.columnHeadersAmount")},{property:"status",label:this.$tc("adyen.columnHeadersStatus")},{property:"createdAt",label:this.$tc("adyen.columnHeadersCreated")},{property:"updatedAt",label:this.$tc("adyen.columnHeadersUpdated")}],showModal:!1,refunds:[],allowRefund:!0,isLoadingTable:!0,errorOccurred:!1,isLoadingRefund:!1,showWidget:!0}},methods:{openModal(){this.showModal=!0},onCloseModal(){this.showModal=!1},onRefund(){this.isLoadingRefund=!0,this.adyenService.postRefund(this.order.id).then(e=>{e.success?(this.fetchRefunds(),this.createNotificationSuccess({title:this.$tc("adyen.refundTitle"),message:this.$tc("adyen.refundSuccessful")})):this.createNotificationError({title:this.$tc("adyen.refundTitle"),message:this.$tc(e.message?e.message:"adyen.refundError")})}).catch(()=>{this.createNotificationError({title:this.$tc("adyen.refundTitle"),message:this.$tc("adyen.refundError")})}).finally(()=>{this.isLoadingRefund=!1,this.showModal=!1})},fetchRefunds(){this.isLoadingTable=!0,this.adyenService.getRefunds(this.order.id).then(e=>{this.refunds=e,this.isRefundAllowed()}).catch(()=>{this.errorOccurred=!0,this.refunds=[]}).finally(()=>{this.isLoadingTable=!1})},isRefundAllowed(){let e=0;for(const n of this.refunds)"Failed"!==n.status&&(e+=n.rawAmount);this.allowRefund=this.order.amountTotal>e/100},isAdyenOrder(){const e=this.order.transactions;let n=!1;for(let t=0;t<e.length;t++)null!==e[t].customFields&&void 0!==e[t].customFields.originalPspReference&&(n=!0);this.showWidget=n}},beforeMount(){this.isAdyenOrder(),this.showWidget&&this.fetchRefunds()}});var u=t("VnLR"),f=t.n(u);Shopware.Component.override("sw-order-detail-base",{template:f.a});var h=t("zNaw");Shopware.Locale.extend("en-GB",h)},Dj87:function(e,n){e.exports='<template>\n    <sw-button-process\n            :disabled="isLoading"\n            :isLoading="isLoading"\n            :processSuccess="isSaveSuccessful"\n            @process-finish="saveFinish"\n            @click="check"\n    >Test Configuration</sw-button-process>\n</template>\n'},EVLM:function(e,n){const t=Shopware.Classes.ApiService,{Application:s}=Shopware;class r extends t{constructor(e,n,t="adyen"){super(e,n,t)}check(e){const n=this.getBasicHeaders({});return this.httpClient.post(`_action/${this.getApiBasePath()}/verify`,e,{headers:n}).then(e=>t.handleResponse(e))}getRefunds(e){const n=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+e+"/refunds",{headers:n}).then(e=>t.handleResponse(e)).catch(e=>{throw console.error("An error occurred during refunds request: "+e.message),e})}postRefund(e){const n=this.getBasicHeaders({});return this.httpClient.post(this.getApiBasePath()+"/refunds",{orderId:e},{headers:n}).then(e=>t.handleResponse(e)).catch(e=>{throw console.error("An error occurred during post refund request: "+e.message),e})}}s.addServiceProvider("adyenService",e=>{const n=s.getContainer("init");return new r(n.httpClient,e.loginService)})},VnLR:function(e,n){e.exports='{% block sw_order_detail_base_custom_fields %}\n    {% parent %}\n    <adyen-refund :order="order"></adyen-refund>\n{% endblock %}\n'},edE1:function(e,n,t){},wqQl:function(e,n,t){var s=t("edE1");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,t("SZ7m").default)("fdb253b0",s,!0,{})},zNaw:function(e){e.exports=JSON.parse('{"adyen":{"configTestTitle":"Configuration test","configTestSuccess":"Configuration is successfully tested","configTestFail":"There\'s an issue in your configuration","refundTitle":"Refund","refundSuccessful":"A refund has been successfully submitted.","invalidRefundAmount":"Refund amount exceeds order total","refundError":"An error has occurred. Please check the logs.","refundFetchError":"An error has occurred while attempting to get linked refunds.","refundConfirm":"Create refund for order","createRefund":"Create Refund","noRefundsCreated":"No refunds created","columnHeadersPspReference":"Adyen Reference","columnHeadersAmount":"Amount","columnHeadersStatus":"Status","columnHeadersCreated":"Created","columnHeadersUpdated":"Updated"}}')}},[["84YS","runtime","vendors-node"]]]);