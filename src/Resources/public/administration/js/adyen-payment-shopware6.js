(this.webpackJsonp=this.webpackJsonp||[]).push([["adyen-payment-shopware6"],{Fxip:function(e,n,t){var r=t("xIYV");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,t("SZ7m").default)("2e468c1c",r,!0,{})},RgpO:function(e,n,t){"use strict";t.r(n);t("UvA/");var r=t("wt28"),o=t.n(r),i=Shopware,a=i.Component,s=i.Mixin;a.register("adyen-config-check-button",{template:o.a,inject:["adyenService"],mixins:[s.getByName("notification")],data:function(){return{isLoading:!1,isSaveSuccessful:!1}},computed:{pluginConfig:function(){for(var e=this.$parent;!e.hasOwnProperty("actualConfigData");)e=e.$parent;var n=e.currentSalesChannelId,t=e.actualConfigData;return Object.assign({},t.null,t[n])}},methods:{saveFinish:function(){this.isSaveSuccessful=!1},check:function(){var e=this;this.isLoading=!0,this.adyenService.check(this.pluginConfig).then((function(n){n.success?(e.isSaveSuccessful=!0,e.createNotificationSuccess({title:e.$tc("adyen.configTestTitle"),message:e.$tc("adyen.configTestSuccess")})):e.createNotificationError({title:e.$tc("adyen.configTestTitle"),message:e.$tc(n.message?n.message:"adyen.configTestFail")}),e.isLoading=!1}))}}});var c=t("w8Bj"),d=t.n(c);t("Fxip");function u(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"==typeof e)return f(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f(e,n)}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var l=Shopware,h=l.Component,p=l.Mixin;h.register("adyen-refund",{template:d.a,inject:["adyenService"],mixins:[p.getByName("notification")],props:{order:{type:Object,required:!0}},data:function(){return{columns:[{property:"pspReference",label:this.$tc("adyen.columnHeaders.pspReference")},{property:"amount",label:this.$tc("adyen.columnHeaders.amount")},{property:"status",label:this.$tc("adyen.columnHeaders.status")},{property:"createdAt",label:this.$tc("adyen.columnHeaders.created")},{property:"updatedAt",label:this.$tc("adyen.columnHeaders.updated")}],showModal:!1,refunds:[],allowRefund:!0,isLoadingTable:!0,errorOccurred:!1,isLoadingRefund:!1,showWidget:!0}},methods:{openModal:function(){this.showModal=!0},onCloseModal:function(){this.showModal=!1},onRefund:function(){var e=this;this.isLoadingRefund=!0,this.adyenService.postRefund(this.order.id).then((function(n){n.success?(e.fetchRefunds(),e.createNotificationSuccess({title:e.$tc("adyen.refundTitle"),message:e.$tc("adyen.refundSuccessful")})):e.createNotificationError({title:e.$tc("adyen.refundTitle"),message:e.$tc(n.message?n.message:"adyen.refundError")})})).catch((function(){e.createNotificationError({title:e.$tc("adyen.refundTitle"),message:e.$tc("adyen.refundError")})})).finally((function(){e.isLoadingRefund=!1,e.showModal=!1}))},fetchRefunds:function(){var e=this;this.isLoadingTable=!0,this.adyenService.getRefunds(this.order.id).then((function(n){e.refunds=n,e.isRefundAllowed()})).catch((function(){e.errorOccurred=!0,e.refunds=[]})).finally((function(){e.isLoadingTable=!1}))},isRefundAllowed:function(){var e,n=0,t=u(this.refunds);try{for(t.s();!(e=t.n()).done;){var r=e.value;"Failed"!==r.status&&(n+=r.rawAmount)}}catch(e){t.e(e)}finally{t.f()}this.allowRefund=this.order.amountTotal>n/100},isAdyenOrder:function(){for(var e=this.order.transactions,n=!1,t=0;t<e.length;t++){var r;void 0!==(null===(r=e[t].customFields)||void 0===r?void 0:r.originalPspReference)&&(n=!0)}this.showWidget=n}},beforeMount:function(){this.isAdyenOrder(),this.showWidget&&this.fetchRefunds()}});var y=t("Ui1M"),g=t.n(y);Shopware.Component.register("adyen-notifications",{template:g.a,inject:["adyenService"],props:{order:{type:Object,required:!0}},data:function(){return{notifications:[],columns:[{property:"pspReference",label:this.$tc("adyen.columnHeaders.pspReference")},{property:"eventCode",label:this.$tc("adyen.columnHeaders.event")},{property:"success",label:this.$tc("adyen.columnHeaders.success")},{property:"amount",label:this.$tc("adyen.columnHeaders.amount")},{property:"status",label:this.$tc("adyen.columnHeaders.status")},{property:"createdAt",label:this.$tc("adyen.columnHeaders.created")},{property:"updatedAt",label:this.$tc("adyen.columnHeaders.updated")}],showWidget:!1}},methods:{fetchNotifications:function(){var e=this;this.adyenService.fetchNotifications(this.order.id).then((function(n){e.notifications=n}))}},beforeMount:function(){this.showWidget=this.adyenService.isAdyenOrder(this.order),this.showWidget&&this.fetchNotifications()}});var v=t("xJoO"),m=t.n(v);Shopware.Component.override("sw-order-detail-base",{template:m.a});var b=t("bY4/");Shopware.Locale.extend("en-GB",b)},Ui1M:function(e,n){e.exports='<template v-if="showWidget">\n    <sw-card :title="$tc(\'adyen.notificationsTitle\')">\n        <sw-data-grid\n                v-if="notifications.length"\n                :dataSource="notifications"\n                :columns="columns"\n                :showActions="false"\n                :showSelection="false"\n        ></sw-data-grid>\n        <p v-if="!notifications.length">{{ $tc(\'adyen.noNotificationsReceived\') }}</p>\n    </sw-card>\n</template>'},"UvA/":function(e,n){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,n){return(i=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function a(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=c(e);if(n){var o=c(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return s(this,t)}}function s(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=Shopware.Classes.ApiService,u=Shopware.Application,f=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&i(e,n)}(u,e);var n,t,s,c=a(u);function u(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adyen";return r(this,u),c.call(this,e,n,t)}return n=u,(t=[{key:"check",value:function(e){var n=this.getBasicHeaders({});return this.httpClient.post("_action/".concat(this.getApiBasePath(),"/verify"),e,{headers:n}).then((function(e){return d.handleResponse(e)}))}},{key:"getRefunds",value:function(e){var n=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+e+"/refunds",{headers:n}).then((function(e){return d.handleResponse(e)})).catch((function(e){throw console.error("An error occurred during refunds request: "+e.message),e}))}},{key:"postRefund",value:function(e){var n=this.getBasicHeaders({});return this.httpClient.post(this.getApiBasePath()+"/refunds",{orderId:e},{headers:n}).then((function(e){return d.handleResponse(e)})).catch((function(e){throw console.error("An error occurred during post refund request: "+e.message),e}))}},{key:"fetchNotifications",value:function(e){var n=this.getBasicHeaders({});return this.httpClient.get(this.getApiBasePath()+"/orders/"+e+"/notifications",{headers:n}).then((function(e){return d.handleResponse(e)})).catch((function(e){throw console.error("An error occurred: "+e.message),e}))}},{key:"isAdyenOrder",value:function(e){for(var n=e.transactions,t=!1,r=0;r<n.length;r++){var o;void 0!==(null===(o=n[r].customFields)||void 0===o?void 0:o.originalPspReference)&&(t=!0)}return t}}])&&o(n.prototype,t),s&&o(n,s),u}(d);u.addServiceProvider("adyenService",(function(e){var n=u.getContainer("init");return new f(n.httpClient,e.loginService)}))},"bY4/":function(e){e.exports=JSON.parse('{"adyen":{"configTestTitle":"Configuration test","configTestSuccess":"Configuration is successfully tested","configTestFail":"There\'s an issue in your configuration","adyenRefunds":"Adyen Refunds","refundTitle":"Refund","refundSuccessful":"A refund has been successfully submitted.","invalidRefundAmount":"Refund amount exceeds order total","refundError":"An error has occurred. Please check the logs.","refundFetchError":"An error has occurred while attempting to get linked refunds.","refundConfirm":"Create refund for order","createRefund":"Create Refund","noRefundsCreated":"No refunds created","columnHeaders":{"pspReference":"PSP Reference","amount":"Amount","status":"Status","event":"Event","success":"Success","created":"Created","updated":"Updated"},"notificationsTitle":"Adyen Notifications","noNotificationsReceived":"No webhook notifications received."}}')},w8Bj:function(e,n){e.exports='{% block adyen_refund %}\n    <sw-card :hero="false" :isLoading="isLoadingTable" :large="false" :title="$tc(\'adyen.adyenRefunds\')" v-if="showWidget">\n        <div v-if="!errorOccurred">\n            <div class="adyen-card-header">\n                <div class="adyen-card-header-first">\n                    <span v-if="!refunds.length">{{ $tc(\'adyen.noRefundsCreated\') }}</span>\n                </div>\n                <div id="modalButtonContainer">\n                    <sw-button\n                        :disabled="!allowRefund"\n                        :square="false"\n                        :block="false"\n                        @click="openModal"\n                        class="sw-button--small">\n                        {{ $tc(\'sw-order.documentCard.labelCreateNew\') }}\n                    </sw-button>\n                </div>\n                <sw-modal v-if="showModal"\n                        @modal-close="onCloseModal"\n                        :title="$tc(\'adyen.createRefund\')"\n                        variant="small">\n                    {{ $tc(\'adyen.refundConfirm\') }}: <b>{{ order.orderNumber }}</b>\n                    <template #modal-footer>\n                        <sw-button @click="onCloseModal" size="small">\n                            {{ $tc(\'global.default.cancel\') }}\n                        </sw-button>\n\n                        <sw-button @click="onRefund" variant="primary" size="small" :isLoading="isLoadingRefund">\n                            {{ $tc(\'sw-order.documentCard.labelCreateNew\') }}\n                        </sw-button>\n                    </template>\n                </sw-modal>\n            </div>\n            <sw-data-grid\n                v-if="refunds.length"\n                :dataSource="refunds"\n                :columns="columns"\n                :showSelection="false"\n                :showActions="false"\n                :isLoading="isLoadingTable">\n            </sw-data-grid>\n        </div>\n        <div v-else>\n            {{ $tc(\'adyen.refundFetchError\') }}\n        </div>\n    </sw-card>\n{% endblock %}\n'},wt28:function(e,n){e.exports='<template>\n    <sw-button-process\n            :disabled="isLoading"\n            :isLoading="isLoading"\n            :processSuccess="isSaveSuccessful"\n            @process-finish="saveFinish"\n            @click="check"\n    >Test Configuration</sw-button-process>\n</template>\n'},xIYV:function(e,n,t){},xJoO:function(e,n){e.exports='{% block sw_order_detail_base_custom_fields %}\n    {% parent %}\n    <adyen-refund :order="order"></adyen-refund>\n    <adyen-notifications :order="order"></adyen-notifications>\n{% endblock %}\n'}},[["RgpO","runtime","vendors-node"]]]);