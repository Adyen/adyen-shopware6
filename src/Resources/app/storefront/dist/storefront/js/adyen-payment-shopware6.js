(window.webpackJsonp=window.webpackJsonp||[]).push([["adyen-payment-shopware6"],{YcTq:function(e,t,n){"use strict";t.a={updatablePaymentMethods:["scheme","ideal","sepadirectdebit","oneclick","dotpay","bcmc","blik"],componentsWithPayButton:{applepay:{extra:{},onClick:function(e,t,n){return n.confirmOrderForm.checkValidity()?(e(),!0):(t(),!1)}},paywithgoogle:{extra:{buttonSizeMode:"fill"},onClick:function(e,t,n){return n.confirmOrderForm.checkValidity()?(e(),!0):(t(),!1)},onError:function(e,t,n){"CANCELED"!==e.statusCode&&("statusMessage"in e?console.log(e.statusMessage):console.log(e.statusCode))}},paypal:{extra:{},onClick:function(e,t,n){return n.confirmOrderForm.checkValidity()},onError:function(e,t,n){t.setStatus("ready"),window.location.href=n.errorUrl.toString()},onCancel:function(e,t,n){t.setStatus("ready"),window.location.href=n.errorUrl.toString()},responseHandler:function(e,t){try{(t=JSON.parse(t)).isFinal&&(location.href=e.returnUrl),this.handleAction(t.action)}catch(e){console.error(e)}}},amazonpay:{extra:{productType:"PayOnly",checkoutMode:"ProcessOrder",returnUrl:location.href},prePayRedirect:!0,sessionKey:"amazonCheckoutSessionId",onClick:function(e,t,n){return n.confirmOrderForm.checkValidity()?(e(),!0):(t(),!1)},onError:function(e,t){console.log(e),t.setStatus("ready")}}},paymentMethodTypeHandlers:{scheme:"handler_adyen_cardspaymentmethodhandler",ideal:"handler_adyen_idealpaymentmethodhandler",klarna:"handler_adyen_klarnapaylaterpaymentmethodhandler",klarna_account:"handler_adyen_klarnaaccountpaymentmethodhandler",klarna_paynow:"handler_adyen_klarnapaynowpaymentmethodhandler",sepadirectdebit:"handler_adyen_sepapaymentmethodhandler",sofort:"handler_adyen_sofortpaymentmethodhandler",paypal:"handler_adyen_paypalpaymentmethodhandler",oneclick:"handler_adyen_oneclickpaymentmethodhandler",giropay:"handler_adyen_giropaypaymentmethodhandler",applepay:"handler_adyen_applepaypaymentmethodhandler",paywithgoogle:"handler_adyen_googlepaypaymentmethodhandler",dotpay:"handler_adyen_dotpaypaymentmethodhandler",bcmc:"handler_adyen_bancontactcardpaymentmethodhandler",amazonpay:"handler_adyen_amazonpaypaymentmethodhandler",blik:"handler_adyen_blikpaymentmethodhandler"}}},j5lx:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var o=n("FGIj"),a=n("gHbT"),r=n("p4AR"),i=n("2Y4b"),d=n("u0Tz"),s=n("YcTq");function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function m(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(t){function n(){return y(this,n),m(this,p(n).apply(this,arguments))}var o,c,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(n,t),o=n,(c=[{key:"init",value:function(){this._client=new r.a,this.stateData=null;var t=adyenCheckoutConfiguration,n=t.locale,o=t.clientKey,i=t.environment,d=t.paymentMethodsResponse,s={locale:n,clientKey:o,environment:i,showPayButton:!0,hasHolderName:!0,paymentMethodsResponse:JSON.parse(d),onAdditionalDetails:this.handleOnAdditionalDetails.bind(this)};this.adyenCheckout=new AdyenCheckout(s),this.confirmOrderForm=a.a.querySelector(document,"#confirmOrderForm"),this.confirmOrderForm.addEventListener("submit",this.onConfirmOrderSubmit.bind(this)),this.paymentComponent=e("[data-adyen-payment-component]"),this.responseHandler=this.handlePaymentAction,this.initializeCustomPayButton()}},{key:"handleOnAdditionalDetails",value:function(e){this._client.post("".concat(adyenCheckoutOptions.paymentDetailsUrl),JSON.stringify({orderId:this.orderId,stateData:e.data}),function(e){200===this._client._request.status?this.responseHandler(e):location.href=this.errorUrl.toString()}.bind(this))}},{key:"onConfirmOrderSubmit",value:function(e){if(adyenCheckoutOptions.selectedPaymentMethodPluginId!==adyenCheckoutOptions.adyenPluginId)return!0;if(adyenCheckoutOptions&&adyenCheckoutOptions.paymentStatusUrl&&adyenCheckoutOptions.checkoutOrderUrl&&adyenCheckoutOptions.paymentHandleUrl){var t=e.target;if(t.checkValidity()){e.preventDefault(),d.a.create(document.body);var n=this.getSelectedPaymentMethodKey();if(!s.a.updatablePaymentMethods.includes(n)||this.stateData){var o=i.a.serialize(t);this.confirmOrder(o)}else this.renderPaymentComponent(n)}}else console.error("Adyen payment configuration missing.")}},{key:"renderPaymentComponent",value:function(t){if("oneclick"!==t){var n=e.grep(this.adyenCheckout.paymentMethodsResponse.paymentMethods,(function(e){return e.type===t}));if(0!==n.length){var o=n[0];this.mountPaymentComponent(o,"[data-adyen-payment-container]",!1),e("[data-adyen-payment-component-modal]").modal({show:!0})}}else this.renderStoredPaymentMethodComponents()}},{key:"renderStoredPaymentMethodComponents",value:function(){var t=this;this.adyenCheckout.paymentMethodsResponse.storedPaymentMethods.forEach((function(e){var n='[data-adyen-stored-payment-method-id="'.concat(e.id,'"]');t.mountPaymentComponent(e,n,!0)})),this.showSelectedStoredPaymentMethod(),e("[name=adyenStoredPaymentMethodId]").change(this.showSelectedStoredPaymentMethod),e("[data-adyen-payment-component-modal]").modal({show:!0})}},{key:"showSelectedStoredPaymentMethod",value:function(){e(".stored-payment-component").hide();var t=e("[name=adyenStoredPaymentMethodId]:checked").val();e('[data-adyen-stored-payment-method-id="'.concat(t,'"]')).show()}},{key:"confirmOrder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=adyenCheckoutOptions.orderId,o=null,a=null;n?(e.set("orderId",n),o=adyenCheckoutOptions.updatePaymentUrl,a=this.afterSetPayment.bind(this,t)):(o=adyenCheckoutOptions.checkoutOrderUrl,a=this.afterCreateOrder.bind(this,t)),this._client.post(o,e,a)}},{key:"afterCreateOrder",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;try{e=JSON.parse(n)}catch(e){return d.a.remove(document.body),void console.log("Error: invalid response from Shopware API",n)}this.orderId=e.id,this.finishUrl=new URL(location.origin+adyenCheckoutOptions.paymentFinishUrl),this.finishUrl.searchParams.set("orderId",e.id),this.errorUrl=new URL(location.origin+adyenCheckoutOptions.paymentErrorUrl),this.errorUrl.searchParams.set("orderId",e.id);var o={orderId:this.orderId,finishUrl:this.finishUrl.toString(),errorUrl:this.errorUrl.toString()};for(var a in t)o[a]=t[a];this._client.post(adyenCheckoutOptions.paymentHandleUrl,JSON.stringify(o),this.afterPayOrder.bind(this,this.orderId))}},{key:"afterSetPayment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;try{var n=JSON.parse(t);n.success&&this.afterCreateOrder(e,JSON.stringify({id:adyenCheckoutOptions.orderId}))}catch(e){return d.a.remove(document.body),void console.log("Error: invalid response from Shopware API",t)}}},{key:"afterPayOrder",value:function(e,t){try{t=JSON.parse(t),this.returnUrl=t.redirectUrl}catch(e){return d.a.remove(document.body),void console.log("Error: invalid response from Shopware API",t)}this.returnUrl===this.errorUrl.toString()&&(location.href=this.returnUrl);try{this._client.post("".concat(adyenCheckoutOptions.paymentStatusUrl),JSON.stringify({orderId:e}),this.responseHandler.bind(this))}catch(e){console.log(e)}}},{key:"handlePaymentAction",value:function(t){e("[data-adyen-payment-component-modal]").modal().hide();try{var n=JSON.parse(t);n.isFinal&&(location.href=this.returnUrl),n.action&&(this.adyenCheckout.createFromAction(n.action).mount("[data-adyen-payment-action-container]"),"threeDS2"===n.action.type&&e("[data-adyen-payment-action-modal]").modal({show:!0}))}catch(e){console.log(e)}}},{key:"initializeCustomPayButton",value:function(){var e=this,t=this.getSelectedPaymentMethodKey();if(t in s.a.componentsWithPayButton){var n=s.a.componentsWithPayButton[t];this.completePendingPayment(t,n);var o=this.adyenCheckout.paymentMethodsResponse.paymentMethods.filter((function(e){return e.type===t}));if(!(o.length<1)){var a=o[0];if(adyenCheckoutOptions.amount)if(n.prePayRedirect)this.renderPrePaymentButton(n,a);else{var r=h(n.extra,a,{amount:{value:adyenCheckoutOptions.amount,currency:adyenCheckoutOptions.currency},onClick:function(t,o){if(!n.onClick(t,o,e))return!1;d.a.create(document.body)},onSubmit:function(e,t){if(e.isValid){var o={stateData:JSON.stringify(e.data)},a=i.a.serialize(this.confirmOrderForm);"responseHandler"in n&&(this.responseHandler=n.responseHandler.bind(t,this)),this.confirmOrder(a,o)}else t.showValidation(),console.log("Payment failed: ",e)}.bind(this),onCancel:function(t,o){d.a.remove(document.body),n.onCancel(t,o,e)},onError:function(t,o){d.a.remove(document.body),n.onError(t,o,e),console.log(t)}}),c=this.adyenCheckout.create(a.type,r);try{"isAvailable"in c?c.isAvailable().then(function(){this.mountCustomPayButton(c)}.bind(this)).catch((function(e){console.log(a.type+" is not available",e)})):this.mountCustomPayButton(c)}catch(e){console.log(e)}}else console.error("Failed to fetch Cart/Order total amount.")}}}},{key:"renderPrePaymentButton",value:function(e,t){var n=this,o=h(e.extra,t,{configuration:t.configuration,amount:{value:adyenCheckoutOptions.amount,currency:adyenCheckoutOptions.currency},onClick:function(t,o){if(!e.onClick(t,o,n))return!1;d.a.create(document.body)},onError:function(t,o){d.a.remove(document.body),e.onError(t,o,n),console.log(t)}}),a=this.adyenCheckout.create(t.type,o);this.mountCustomPayButton(a)}},{key:"completePendingPayment",value:function(e,t){var n=new URL(location.href);if(n.searchParams.has(t.sessionKey)){var o;d.a.create(document.body);var a=this.adyenCheckout.create(e,(l(o={},t.sessionKey,n.searchParams.get(t.sessionKey)),l(o,"showOrderButton",!1),l(o,"onSubmit",function(e,t){if(e.isValid){var n={stateData:JSON.stringify(e.data)},o=i.a.serialize(this.confirmOrderForm);this.confirmOrder(o,n)}}.bind(this)),o));this.mountCustomPayButton(a),a.submit()}}},{key:"getSelectedPaymentMethodKey",value:function(){return Object.keys(s.a.paymentMethodTypeHandlers).find((function(e){return s.a.paymentMethodTypeHandlers[e]===adyenCheckoutOptions.selectedPaymentMethodHandler}))}},{key:"mountCustomPayButton",value:function(t){var n=e('<div id="adyen-confirm-button" data-adyen-confirm-button></div>');e("#confirmOrderForm").append(n),t.mount(n.get(0)),e("#confirmOrderForm button[type=submit]").remove()}},{key:"mountPaymentComponent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=h(e,{onSubmit:function(e,t){if(this.paymentComponent.find(".loader").show(),this.paymentComponent.find("[data-adyen-payment-container]").hide(),e.isValid){var n={stateData:JSON.stringify(e.data)},o=i.a.serialize(this.confirmOrderForm);this.confirmOrder(o,n)}else t.showValidation(),console.log("Payment failed: ",e)}.bind(this)});n||"scheme"!==e.type||(o.enableStoreDetails=!0);try{var a=this.adyenCheckout.create(e.type,o);a.mount(this.paymentComponent.find(t).get(0)),this.paymentComponent.find(".loader").hide()}catch(t){return console.error(e.type,t),!1}}}])&&u(o.prototype,c),v&&u(o,v),n}(o.a)}).call(this,n("UoTJ"))},jC4o:function(e,t,n){"use strict";n.r(t);var o=n("j5lx");window.PluginManager.register("ConfirmOrderPlugin",o.a,"[data-adyen-payment]")}},[["jC4o","runtime","vendor-node","vendor-shared"]]]);