#on:
#  release:
#    types: [created, edited]

on: ["push", "workflow_dispatch"]
name: Upload Release Asset

jobs:
  run:
    name: Upload Release Asset
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare release artifact
        run: .github/workflows/scripts/prepare-release.sh

      - name: Gather Latest Release Information
        id: get-release-info
        run: |
          response=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/releases/latest")
          
          release_id=$(echo "$response" | jq -r '.id')
          upload_url=$(echo "$response" | jq -r '.upload_url' | sed 's/{?name,label}//g')
          tag_name=$(echo "$response" | jq -r '.tag_name')
          
          echo "tag_name=$tag_name" >> $GITHUB_OUTPUT
          echo "Latest Release ID: $release_id"
          echo "Latest Release Upload URL: $upload_url"
          echo "Latest Release Tag name: $tag_name"

      - name:  Upload asset
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release upload ${{ steps.get-release-info.outputs.tag_name }} AdyenPaymentShopware6.zip --clobber